# WWW_433 Installation Guide

The WWW_433 files provide web service support for the WS_433 WeatherStation system with PHP and Python code examples for an Apache2 server to create web-page graphical displays using Google Charts.  Because there are so many ways to set up a web site, this guide provides tools and suggestions rather than a quick installation.

So, because casual installation of these files might interfere with an exisiting web site, the installation script in `Makefile` simply moves the PHP files to the `/var/www/html` directory and creates, if necessary, and sets protections on the database file.  Two example PHP files are provided for use by those who have web services already in operation and would like to incorporate pages that would display recent historical meteorological data.  A Python script is provided as a model for sites that prefer that system.

For those with no web site running, instructions are provided below on how to install the graphical web page as the "home" page on an Apache2 server.

## Installing on a New Server

These instructions assume that you're using sqlite3 for database storage.  You'll need to modify the code if you're using MariaDB/MySQL.

Do not perform this installation on an existing, operational web server.

1.  Install the Apache2 server.  For example, for a Raspberry Pi running Raspbian OS, follow the guide [here](https://www.tomshardware.com/news/raspberry-pi-web-server,40174.html) or [here](https://pimylifeup.com/raspberry-pi-apache/) to create a functioning web server.  Confirm its operation by connecting to that site with a web browser: you should see the standard Debian distribution web page.  Check to verify where that page is located.  Under Raspberry Pi OS, it's located in `/var/wwww/html/` as file `index.html`.  The remaining instructions assume that as the location for the web pages.
2.  Install the php-sqlite3 module.  For example, `sudo apt-get install php-sqlite3` on Debian Linux.
3.  From the `WS_433/WWW_433` repository directory, copy the web graphing files to the web directory and set the directory and file protections for database access by the PHP scripts:
```
   sudo make install
```
4.  Connect to the Apache2 web directory, `sudo cd /var/www/html` 
5.  Confirm you have a functioning sqlite3 weather database by issuing the commands:
```
$sqlite3 /var/databases/Weather.db
sqlite> select * from SensorData;
2025-04-28 15:46:08|Neighbor|24.7|0.0|23.0|0.0|0.0
2025-04-28 15:46:53|Deck|22.8|0.0|12.0|0.0|0.0
2025-04-28 15:47:25|Office|25.0|24.0|46.0|1021.9|73.0
2025-04-28 15:49:23|LaCrosse-TX141THBv2/221/0|23.0|0.0|17.0|0.0|0.0
...
```
6.  Edit `WeatherGraph.php` to change 'Deck' to one of the sensors that your rtl_433 server "sees", from the list generated by the sqlite3 SELECT statement (above).
7.  Confirm that the graphing programs generate a web page from your sqlite3 database:
    *  `sudo php WeatherGraph.php > page.html` to generate a web page with a weather data graph
    *  view that file `page.html` with a web browser.  For example copy it to your desktop if you're working on the console for that computer, or copy it to another computer that has a web browser, and then click on the file to bring it up in a web browser.
    *  If the web page doesn't show any data, check your sqlite3 database file access permissions; if you've changed the name or location of the database file, you'll need to change it in the PHP and Python code, too.
8.  Once you've confirmed that the PHP code generates the graphic web page, you're ready to put it into production:
    *  `sudo cd /var/www/html`
    *  Set the distribution home page aside: `sudo mv index.html distribution-index.html`
    *  Make the PHP code your new home page: `sudo cp WeatherGraph.php index.php`.
9.  Now connect to that server with a browser and you should see the graphical display of your weather history.

The second PHP program, `TP-merge.php`, demonstrates how readings from two different sensors might be integrated into one graphical web page. Specifically, the repository version of `TP-merge.php` combines the temperature from an outdoor sensor ("Deck"), that does not have a pressure sensor, with the pressure reading from an indoor sensor ("Desk"). It combines those readings in 10-minute "bins", since the two sensors are not synchronized to broadcast readings at the same time.  That code would require similar editing of the sensorIDs and field values for your particular use case.  Because it creates a temporary database table, the ownership of `/var/database/` and `/var/database/Weather.db` must be set to `www-data`, which the `make install` command does for you.  (Modify that ownership if you've change your `apache2` settings.)  The following is a screenshot of what the web page from TP-merge.php looks like (temperature is from sensorID "Deck" and pressure is from sensorID "Desk").

<img width="1018" alt="TP-Merge Graph" src="https://github.com/user-attachments/assets/7ec3ae71-0f0d-4b15-b719-ba6ad827f9fc" />


## Existing Web Sites

If you already have a functioning web site, you likely want to add the weather graph as a new page rather than use it to replace your existing site.

You can either link to that WeatherGraph.php file from an existing page on your site, or you can embed a call to WeatherGraph.py if you have enabled Python executables in your web service.

Copy the `WS_433/WWW_433/WeatherGraph.*` files to the appropriate directory in your web server directory tree and link to them there from your web pages.  As with the instructions above, you might want to confirm that the programs can access the sqlite3 database and generate web pages by, for example, `php WeatherGraph.php > page.html` and confirm that `page.html` displays the graph as expected.

## Customizations

The WeatherGraph.* and TP-merge.php files are simply prototypes for displays that you might want to create.  For example, you might prefer to see displays of `temperature_C` and `pressure_hPa` in your graphs.  If so, you'll need to edit WeatherGraph.php  to select other variables for display (if your sensor reports both temperature and pressure) or edit `TP-merge.php` if you need to merge readings from different sensors.  Change the labels on the graphs, too.

If you're an experienced web programmer, you might want to create multiple `.php` programs for different SensorID's and for different variables, or you might want to select parameters from a list and generate the graphing code dynamically.

## Author

David Todd, HDTodd@gmail.com, 2025.04.28, but modeled on code provided by others, most notably by Craig Deaton.  Updated 2025.06.25 to add TP-merge.php.




